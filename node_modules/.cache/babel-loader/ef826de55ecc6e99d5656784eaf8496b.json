{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _PageTitle = _interopRequireDefault(require(\"../../components/PageTitle\"));\n\nvar _PluginCard = _interopRequireDefault(require(\"./PluginCard\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar _MarketplaceBanner = _interopRequireDefault(require(\"./MarketplaceBanner\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar MarketPlacePage = function MarketPlacePage() {\n  var history = (0, _reactRouterDom.useHistory)();\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      autoReload = _useGlobalContext.autoReload,\n      emitEvent = _useGlobalContext.emitEvent,\n      currentEnvironment = _useGlobalContext.currentEnvironment,\n      formatMessage = _useGlobalContext.formatMessage,\n      plugins = _useGlobalContext.plugins;\n\n  var _useFetchPluginsFromM = (0, _hooks.useFetchPluginsFromMarketPlace)(),\n      error = _useFetchPluginsFromM.error,\n      isLoading = _useFetchPluginsFromM.isLoading,\n      data = _useFetchPluginsFromM.data;\n\n  var emitEventRef = (0, _react.useRef)(emitEvent);\n  (0, _react.useEffect)(function () {\n    emitEventRef.current('didGoToMarketplace');\n  }, []);\n\n  if (isLoading || error) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null);\n  }\n\n  var handleDownloadPlugin = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(pluginId) {\n      var overlayblockerParams, opts, response;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              emitEvent('willInstallPlugin', {\n                plugin: pluginId\n              }); // Force the Overlayblocker to be displayed\n\n              overlayblockerParams = {\n                enabled: true,\n                title: 'app.components.InstallPluginPage.Download.title',\n                description: 'app.components.InstallPluginPage.Download.description'\n              }; // Lock the app\n\n              strapi.lockApp(overlayblockerParams);\n              _context.prev = 3;\n              opts = {\n                method: 'POST',\n                body: {\n                  plugin: pluginId,\n                  port: window.location.port\n                }\n              };\n              _context.next = 7;\n              return (0, _strapiHelperPlugin.request)('/admin/plugins/install', opts, overlayblockerParams);\n\n            case 7:\n              response = _context.sent;\n\n              if (response.ok) {\n                emitEvent('didInstallPlugin', {\n                  plugin: pluginId\n                }); // Reload the app\n\n                window.location.reload();\n              }\n\n              _context.next = 15;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](3);\n              strapi.unlockApp();\n              strapi.notification.toggle({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 11]]);\n    }));\n\n    return function handleDownloadPlugin(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, /*#__PURE__*/_react[\"default\"].createElement(_PageTitle[\"default\"], {\n    title: formatMessage({\n      id: 'app.components.InstallPluginPage.helmet'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, {\n    title: {\n      label: formatMessage({\n        id: 'app.components.InstallPluginPage.title'\n      })\n    },\n    content: formatMessage({\n      id: 'app.components.InstallPluginPage.description'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_MarketplaceBanner[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"row\",\n    style: {\n      paddingTop: '4.1rem'\n    }\n  }, data.map(function (plugin) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_PluginCard[\"default\"], {\n      autoReload: autoReload,\n      currentEnvironment: currentEnvironment,\n      downloadPlugin: handleDownloadPlugin,\n      key: plugin.id,\n      history: history,\n      plugin: plugin,\n      showSupportUsButton: false,\n      isAlreadyInstalled: plugins[plugin.id] !== undefined\n    });\n  }))));\n};\n\nvar _default = MarketPlacePage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/home/zenack/Trabajo/Strapi-concept/.cache/admin/src/containers/MarketplacePage/index.js"],"names":["MarketPlacePage","history","autoReload","emitEvent","currentEnvironment","formatMessage","plugins","error","isLoading","data","emitEventRef","current","handleDownloadPlugin","pluginId","plugin","overlayblockerParams","enabled","title","description","strapi","lockApp","opts","method","body","port","window","location","response","ok","reload","unlockApp","notification","toggle","type","message","id","label","paddingTop","map","undefined"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { LoadingIndicatorPage, useGlobalContext, request } from 'strapi-helper-plugin';\nimport { Header } from '@buffetjs/custom';\nimport { useHistory } from 'react-router-dom';\n\nimport { useFetchPluginsFromMarketPlace } from '../../hooks';\nimport PageTitle from '../../components/PageTitle';\nimport PluginCard from './PluginCard';\nimport Wrapper from './Wrapper';\nimport MarketplaceBanner from './MarketplaceBanner';\n\nconst MarketPlacePage = () => {\n  const history = useHistory();\n  const { autoReload, emitEvent, currentEnvironment, formatMessage, plugins } = useGlobalContext();\n  const { error, isLoading, data } = useFetchPluginsFromMarketPlace();\n  const emitEventRef = useRef(emitEvent);\n\n  useEffect(() => {\n    emitEventRef.current('didGoToMarketplace');\n  }, []);\n\n  if (isLoading || error) {\n    return <LoadingIndicatorPage />;\n  }\n\n  const handleDownloadPlugin = async pluginId => {\n    emitEvent('willInstallPlugin', { plugin: pluginId });\n\n    // Force the Overlayblocker to be displayed\n    const overlayblockerParams = {\n      enabled: true,\n      title: 'app.components.InstallPluginPage.Download.title',\n      description: 'app.components.InstallPluginPage.Download.description',\n    };\n\n    // Lock the app\n    strapi.lockApp(overlayblockerParams);\n\n    try {\n      const opts = {\n        method: 'POST',\n        body: {\n          plugin: pluginId,\n          port: window.location.port,\n        },\n      };\n      const response = await request('/admin/plugins/install', opts, overlayblockerParams);\n\n      if (response.ok) {\n        emitEvent('didInstallPlugin', { plugin: pluginId });\n        // Reload the app\n        window.location.reload();\n      }\n    } catch (err) {\n      strapi.unlockApp();\n      strapi.notification.toggle({\n        type: 'warning',\n        message: { id: 'notification.error' },\n      });\n    }\n  };\n\n  return (\n    <div>\n      <PageTitle\n        title={formatMessage({\n          id: 'app.components.InstallPluginPage.helmet',\n        })}\n      />\n      <Wrapper>\n        <Header\n          title={{\n            label: formatMessage({\n              id: 'app.components.InstallPluginPage.title',\n            }),\n          }}\n          content={formatMessage({\n            id: 'app.components.InstallPluginPage.description',\n          })}\n        />\n        <MarketplaceBanner />\n        <div className=\"row\" style={{ paddingTop: '4.1rem' }}>\n          {data.map(plugin => {\n            return (\n              <PluginCard\n                autoReload={autoReload}\n                currentEnvironment={currentEnvironment}\n                downloadPlugin={handleDownloadPlugin}\n                key={plugin.id}\n                history={history}\n                plugin={plugin}\n                showSupportUsButton={false}\n                isAlreadyInstalled={plugins[plugin.id] !== undefined}\n              />\n            );\n          })}\n        </div>\n      </Wrapper>\n    </div>\n  );\n};\n\nexport default MarketPlacePage;\n"]},"metadata":{},"sourceType":"script"}